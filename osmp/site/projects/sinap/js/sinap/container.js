"use strict";System.register(["./terms","./fieldGroup","./element","./widget","../sinap"],function(_export,_context){function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var Terms,FieldGroup,Element,Widget,Sinap,_createClass,Container;return{setters:[function(_terms){Terms=_terms["default"]},function(_fieldGroup){FieldGroup=_fieldGroup["default"]},function(_element){Element=_element["default"]},function(_widget){Widget=_widget["default"]},function(_sinap){Sinap=_sinap["default"]}],execute:function(){_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Container=function(){function Container(_ref,initial){var _ref$elements=_ref.elements,elements=void 0===_ref$elements?[]:_ref$elements,terms=_ref.terms,_ref$fieldGroups=_ref.fieldGroups,fieldGroups=void 0===_ref$fieldGroups?[]:_ref$fieldGroups;if(_classCallCheck(this,Container),this._terms=Terms(terms),this.fieldGroups=fieldGroups.map(FieldGroup),initial&&this._terms&&this._terms.isQWOnline){var visible=elements.find(function(element){return element.type===Element.TYPE.FIELD&&element.view});visible.view.widget.type===Widget.TYPE.RADIO&&visible.view.widget.choices.length<4?visible.view.widget.choices.unshift({value:Sinap.WELCOME_VALUE,title:"Welcome!"}):elements.splice(elements.indexOf(visible),0,{type:Element.TYPE.FIELD,name:Sinap.WELCOME_VALUE,view:{widget:{type:Widget.TYPE.WELCOME,choices:[{value:Sinap.WELCOME_VALUE,title:"Welcome!"},{value:"-1",title:elements.find(function(element){return element.view&&element.view.title}).view.title}]}}})}this.elements=elements.map(Element)}return _createClass(Container,[{key:"pages",value:function(){var _this=this,previousForm=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];return Promise.reduce(this.elements.map(function(element){return function(previousForm){return element.pages(previousForm).then(function(){var newForm=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];return[].concat(_toConsumableArray(previousForm),_toConsumableArray(newForm))})}}),previousForm).then(function(newForm){return newForm.filter(function(newElement){return!previousForm.find(function(oldElement){return oldElement===newElement})})}).then(function(pages){return _this.fieldGroups.reduce(function(elements,fieldGroup){return fieldGroup.group(elements)},pages)})}},{key:"terms",value:function(pages){var _ref2;return(_ref2=[this._terms]).concat.apply(_ref2,_toConsumableArray(this.elements.map(function(element){return element.terms&&element.terms(pages)}))).filter(function(a){return a})}},{key:"fill",value:function(from,pages){return Promise.all(this.elements.map(function(el){return el.fill(from,pages)})).then(function(results){return results.map(function(result){return result||""}).join("")})}}]),Container}(),_export("default",function(config,initial){return new Container(config,initial)})}}});
"use strict";System.register(["jsx!pages/page","validators"],function(t,e){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o,r,a,l,d,f;return{setters:[function(t){o=t["default"]},function(t){r=t["default"]}],execute:function(){a=function(){function t(t,e){var i=[],n=!0,s=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done)&&(i.push(r.value),!e||i.length!==e);n=!0);}catch(l){s=!0,o=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(s)throw o}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),d=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in s)return s.value;var r=s.get;if(void 0!==r)return r.call(n)},f=function(t){function e(){i(this,e);var t=n(this,Object.getPrototypeOf(e).call(this,"first"));return t.timeout=12e4,t.logo="../projects/identification/img/security.png",t._validFieldsCount=0,t.fields={last_name:{title:qiwi.i18n("second_name"),validator:new r.NameValidator},first_name:{title:"Имя",validator:new r.NameValidator},middle_name:{title:"Отчество",validator:new r.NameValidator},birthday:{title:"Дата рождения",validator:new r.DateValidator(new Date((new Date).getFullYear()-91,(new Date).getMonth(),(new Date).getDate()),new Date((new Date).getFullYear()-14,(new Date).getMonth(),(new Date).getDate())),mask:{shown:"ДД.ММ.ГГГГ",inner:"**.**.****",isMasked:!0},isNumeric:!0},passport:{title:"Серия и номер паспорта",validator:new r.PassportValidator,mask:{shown:"XXXX XXXXXX",inner:"**** ******"},isNumeric:!0}},t}return s(e,t),l(e,[{key:"onShow",value:function(){var t=this;d(Object.getPrototypeOf(e.prototype),"onShow",this).call(this).then(function(){t._failFields=[],t.setHeader(qiwi.i18n("enter_pin_firstdocument"),qiwi.i18n("enter_pin_firstdocument_subtitle"),""),t.fields.last_name.text=t.session.get("identification").firstdocument.lastname,t.fields.first_name.text=t.session.get("identification").firstdocument.firstname,t.fields.middle_name.text=t.session.get("identification").firstdocument.middlename,t.fields.birthday.text=t.session.get("identification").firstdocument.birthdate,t.fields.passport.text=t.session.get("identification").firstdocument.passportnumber.toString(),t.showPreloader()}).then(function(){return qiwi.utils.require("text!../../res/names_first.txt","text!../../res/names_middle.txt","text!../../res/names_second.txt","autocomplete")}).then(function(e){var i=a(e,4),n=i[0],s=i[1],o=i[2],r=i[3];t.hidePreloader(),t.fields.first_name.autocomplete=new r(n.split("\n")),t.fields.last_name.autocomplete=new r(o.split("\n")),t.fields.middle_name.autocomplete=new r(s.split("\n"))},function(t){}).done(function(){t.updateNavigation({nextButton:{enabled:!1},prevButton:{visible:!1}}),t.update()})}},{key:"performExit",value:function(){var t=this;this.showPopup({type:"info",title:"Сообщите данные по телефону",message:"Если вы не хотите самостоятельно заполнять анкету или у вас\nнет под рукой нужного документа, продиктуйте данные\nпо бесплатному телефону 8 800 707-77-59",okHandler:function(){return t.exit()},okButtonText:"НА ГЛАВНУЮ",okButtonAutoSize:!0})}},{key:"performBackward",value:function(){this.statistics.page_data({valid_fields_count:this._validFieldsCount}),this.session.get("identification").title?this.exit({url:"./index.html?ereceipt"}):this.exit()}},{key:"performForward",value:function(){var t=this;this.request("wallet.confirm-user-profile",{login:this.session.get("identification").login,pin:this.session.get("identification").login0,phone:this.session.get("identification").phone,first_name:this.fields.first_name.text,middle_name:this.fields.middle_name.text,last_name:this.fields.last_name.text,birth_date:qiwi.utils.mask(this.fields.birthday.text,this.fields.birthday.mask.inner),passport_number:this.fields.passport.text,second_documents:"",version:qiwi.application.toString()}).done(function(e){t.session.get("identification").firstdocument.firstname=t.fields.first_name.text,t.session.get("identification").firstdocument.middlename=t.fields.middle_name.text,t.session.get("identification").firstdocument.lastname=t.fields.last_name.text,t.session.get("identification").firstdocument.birthdate=qiwi.utils.mask(t.fields.birthday.text,t.fields.birthday.mask.inner),t.session.get("identification").firstdocument.passportnumber=t.fields.passport.text,t.session.get("identification").verified=e.response.body.verified[0]._text,t.statistics.page_data({verified:e.response.body.verified[0]._text}),e.response.body.verified[0]._text?(t.session.get("identification").seconddocument.inn=e.response.body.inn[0]._text,t.jump("ok")):t.loadElements(["failPopupContent"]).then(function(e){var i=a(e,1),n=i[0];t.showPopup({type:"question",customContent:t.createReactElement(n,{title:"Ваши данные не прошли автоматическую проверку",message:t.session.get("identification").firstdocument.firstname+" "+t.session.get("identification").firstdocument.middlename+" "+t.session.get("identification").firstdocument.lastname+"\nДата рождения: "+t.session.get("identification").firstdocument.birthdate+"\nПаспорт: "+qiwi.utils.mask(t.session.get("identification").firstdocument.passportnumber,t.fields.passport.mask.inner)}),okHandler:function(){return t.jump("fail")},okButtonText:"Данные верны",okButtonAutoSize:!0,cancelButtonText:"Исправить"})})["catch"](function(t){throw new qiwi.errors.SystemError("Error load element for popup: ",t)}).done()},function(t){throw new qiwi.errors.UserError(t.message)})}},{key:"disabledForward",value:function(){var t=this;d(Object.getPrototypeOf(e.prototype),"disabledForward",this).call(this),this.update({highlight:!0}),setTimeout(function(){return t.update({highlight:!1})})}},{key:"onUpdate",value:function(t){this.updateNavigation({nextButton:{enabled:Object.keys(this.fields).length-(this._validFieldsCount=t)===0},prevButton:{visible:!1}})}},{key:"createClass",value:function(){var t=this;return this.loadElements(["fieldBlock","keyboard"]).then(function(i){var n=a(i,2),s=n[0],o=n[1];return d(Object.getPrototypeOf(e.prototype),"createClass",t).call(t,{componentWillReceiveProps:function(t){t.highlight&&this.fieldFunctions.highlight(this.failFields)},getInitialState:function(){return{shift:!0,numeric:!1}},getDefaultProps:function(){return{fields:{},onUpdate:function(){}}},onUpdate:function(t){var e=this;t&&this.setState({shift:0===this.props.fields[t].text.length,numeric:!!this.props.fields[t].isNumeric}),this.failFields=[],qiwi.utils.forEach(this.props.fields,function(t,i){e.props.fields[i].validator.validate(t.mask&&t.mask.isMasked?qiwi.utils.mask(t.text,t.mask.inner):t.text)||e.failFields.push(i)}),this.props.onUpdate(Object.keys(this.props.fields).length-this.failFields.length)},fieldFunctions:{addSymbol:function(){},removeAll:function(){},highlight:function(){}},render:function(){var t=this;return React.createElement("div",{id:"fio-page"},0===Object.keys(this.props.fields).length?null:React.createElement(s,{fields:this.props.fields,onUpdate:this.onUpdate,fieldFunctions:this.fieldFunctions}),React.createElement(o,{onClick:function(e){return t.fieldFunctions.addSymbol(e)},onEraseAll:this.fieldFunctions.removeAll,controlOptions:{shiftDisabled:!0,languageDisabled:!0},showOptions:{alwaysCaps:!0},shift:this.state.shift,numeric:this.state.numeric}))}})})}},{key:"state",get:function(){return{fields:this.fields}}}]),e}(o),t("default",f)}}});
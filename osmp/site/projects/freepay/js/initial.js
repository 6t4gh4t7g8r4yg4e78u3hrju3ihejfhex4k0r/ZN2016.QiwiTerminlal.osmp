"use strict";System.register(["#initial","model/user","terminal","commissions","stores/regProvider","model/freepay","stores/provider","payment","storage"],function(_export,_context){var Init,User,Terminal,Commissions,RegProvider,Model,Provider,Payment,Storage;return{setters:[function(_initial){Init=_initial["default"]},function(_modelUser){User=_modelUser["default"]},function(_terminal){Terminal=_terminal["default"]},function(_commissions){Commissions=_commissions["default"]},function(_storesRegProvider){RegProvider=_storesRegProvider["default"]},function(_modelFreepay){Model=_modelFreepay["default"]},function(_storesProvider){Provider=_storesProvider["default"]},function(_payment){Payment=_payment["default"]},function(_storage){Storage=_storage["default"]}],execute:function(){_export("default",{run:function(){return Init.run.apply(Init,arguments).then(function(){return Terminal.send("GetPrtStatus","true","PrtStatus")}).then(function(_ref){var PrtStatus=_ref.PrtStatus;return"OK"===PrtStatus?Promise.resolve():Promise.reject(qiwi.i18n("errors.printerError"))}).then(function(){return Terminal.send("PrvId",Storage.get("provider"),"PrvAllow|PrvDenied")}).then(function(_ref2){var PrvAllow=_ref2.PrvAllow;return PrvAllow?Promise.resolve():Promise.reject()}).then(function(){return Terminal.send("GetStartParam","true","StartParam")}).then(function(_ref3){var StartParam=_ref3.StartParam;return Provider.startParam=StartParam}).then(function(){return RegProvider.getProvider(Storage.get("provider"))}).then(function(_ref4){var logo=_ref4.logo,id=_ref4.id,minSum=_ref4.minSum,maxSum=_ref4.maxSum,longName=_ref4.longName;Payment.state.logo="../img/ui_item/"+logo,Payment.state.provider.id=id,Payment.state.configMinSum=Math.max(Payment.state.minSum,minSum),Payment.state.minSum=Math.max(Payment.state.minSum,minSum),Payment.state.maxSum=Math.min(Payment.state.maxSum,maxSum),Payment.state.provider.fullName=longName,Payment.state.paymentSchema=Payment.schemas.QD,Payment.state.qwCommissions=new Commissions(Payment.state.qwCommissionsSource,0),Model.purpose={prefix:Payment.state.startParam.split(";")[2],postfix:Payment.state.startParam.split(";").length>2?Payment.state.startParam.split(";")[3]:""},User.currentCurrency=Payment.state.currency,Terminal.send("GetMaxSummByPrv",Payment.state.provider.id,"GetMaxSummByPrv").then(function(res){return Payment.state.maxSum=res.GetMaxSummByPrv})})}})}}});
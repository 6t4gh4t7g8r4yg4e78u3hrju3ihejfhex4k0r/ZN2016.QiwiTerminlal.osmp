"use strict";System.register(["jsx!pages/requiredWalletAuth","model/user","model/appSettings","payment"],function(_export,_context){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var RequiredWalletAuth,User,AppSettings,Payment,_slicedToArray,_createClass,_get,_class;return{setters:[function(_jsxPagesRequiredWalletAuth){RequiredWalletAuth=_jsxPagesRequiredWalletAuth["default"]},function(_modelUser){User=_modelUser["default"]},function(_modelAppSettings){AppSettings=_modelAppSettings["default"]},function(_payment){Payment=_payment["default"]}],execute:function(){_slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_class=function(_RequiredWalletAuth){function _class(){return _classCallCheck(this,_class),_possibleConstructorReturn(this,Object.getPrototypeOf(_class).call(this,"mainMenu"))}return _inherits(_class,_RequiredWalletAuth),_createClass(_class,[{key:"onShow",value:function(){_get(Object.getPrototypeOf(_class.prototype),"onShow",this).call(this),this.authorized=User.authorizeState.authorized,this.unpaidInvoicesCount=0,this.setUserInfo(),Payment.resetState(),this.updateNavigation({prevButton:{visible:!1},nextButton:{visible:!1}}),this.needAuth={show:!1},this.setLogo("../projects/wallet/img/vqw.png"),this.checkUnpaidInvoices(),this.update()}},{key:"onTopup",value:function(){this.jump("topup")}},{key:"checkUnpaidInvoices",value:function(){var _this2=this;User.authorizeState.authorized&&User.hasUnpaidInvoices&&this.loadElements(["tablePopupContent"]).then(function(_ref){var _ref2=_slicedToArray(_ref,1),UnpaidInvoicesPopupContent=_ref2[0];_this2.showPopup({type:"question",okButtonText:qiwi.i18n("mainMenuPage.goto_payment_button"),cancelButtonText:qiwi.i18n("popups.cancel"),customContent:_this2.createReactElement(UnpaidInvoicesPopupContent,{title:User.invoices.length>1?qiwi.i18n("mainMenuPage.invoices_header_many"):qiwi.i18n("mainMenuPage.invoices_header_one"),items:[{title:User.invoices.length>1?qiwi.i18n("mainMenuPage.invoices_title_many"):qiwi.i18n("mainMenuPage.invoices_title_one"),data:qiwi.i18n("mainMenuPage.invoices_summ"),keyStyle:"item-title",valueStyle:"item-title"}].concat(User.invoices.slice(0,3).map(function(item){return{title:item.trm_id,data:item.amount+" "+item.currencyText}}))}),okHandler:function(){User.hasUnpaidInvoices=!1,_this2.jump("invoices")},cancelHandler:function(){User.hasUnpaidInvoices=!1}})})["catch"](function(error){throw new qiwi.errors.SystemError("Error load element for popup: ",error)}).done(),User.authorizeState.authorized?this.unpaidInvoicesCount=User.invoices.length:this.unpaidInvoicesCount=0,this.update()}},{key:"setUserInfo",value:function(){this.authorized=User.authorizeState.authorized,this.balance=-1,this.phone=User.login.formatted,this.update()}},{key:"onLogout",value:function(){User.reset(),this.setUserInfo(),this.checkUnpaidInvoices(),this.update()}},{key:"onShowBalance",value:function(){var _this3=this;this.checkFullAuth().then(function(){_this3.balance=User.getBalanceByCode(User.currentCurrency,User.currentCurrencyTitle),_this3.update()})["catch"](function(error){error&&_this3.showPopup({type:"error",message:error.message||qiwi.i18n("requests.transport")})})}},{key:"onInvoices",value:function(){this.jump("invoices")}},{key:"onCredit",value:function(){var _this4=this;User.authorizeState.authorized?this.showPopup({type:"question",title:qiwi.i18n("popups.attention"),message:qiwi.i18n("mainMenuPage.gotoCreditGroup"),okButtonText:qiwi.i18n("mainMenuPage.goto"),cancelButtonText:qiwi.i18n("popups.cancel"),okHandler:function(){_this4.openInterfacePage({page:"category",provider:"-161"})}}):this.openInterfacePage({page:"category",provider:"-161"})}},{key:"performExit",value:function(){User.authorizeState.authorized?_get(Object.getPrototypeOf(_class.prototype),"performExit",this).call(this):this.exit()}},{key:"createClass",value:function(){var _this5=this;return this.loadElements(["iconButton","login"]).then(function(_ref3){var _ref4=_slicedToArray(_ref3,2),Button=_ref4[0],Login=_ref4[1];return _get(Object.getPrototypeOf(_class.prototype),"createClass",_this5).call(_this5,{render:function(){var page=this.props.context;return React.createElement("div",{id:"mainMenu-page"},React.createElement("div",{className:"login-element"},React.createElement(Login,{authorized:this.props.authorized,balance:this.props.balance,phone:this.props.phone,onLogin:function(){return page.actionWithAuth({onSuccess:function(){page.setUserInfo(),page.checkUnpaidInvoices()},onCancel:function(){return page.setUserInfo()}})},onLogout:function(){return page.onLogout()},onShowBalance:function(){return page.onShowBalance()}})),React.createElement("div",{className:"buttons-container"},React.createElement("div",{className:"buttons-first-row-container"},React.createElement(Button,{className:"buttons-first-row",width:"580",icon:"../projects/wallet/img/icons/topup.png",text:qiwi.i18n("mainMenuPage.buttons.topup"),onClick:function(){return page.onTopup()}}),React.createElement(Button,{className:"buttons-first-row",width:"580",icon:this.props.unpaidInvoicesCount>0?"../projects/wallet/img/icons/unpaidBillsCounter.png":"../projects/wallet/img/icons/invoices.png",iconText:this.props.unpaidInvoicesCount>0?this.props.unpaidInvoicesCount:"",text:qiwi.i18n("mainMenuPage.buttons.invoices"),onClick:function(){return page.actionWithAuth({action:function(){return page.onInvoices()},full:!1})}})),React.createElement("div",{className:"buttons-second-row-container"},React.createElement(Button,{className:"buttons-second-row",icon:"../projects/wallet/img/icons/credit.png",text:qiwi.i18n("mainMenuPage.buttons.credit"),onClick:function(){return page.onCredit()}}),React.createElement(Button,{className:"buttons-second-row",icon:"../projects/wallet/img/icons/providers.png",text:qiwi.i18n("mainMenuPage.buttons.providers"),onClick:function(){return page.openInterfacePage({page:"search"})}}),React.createElement(Button,{className:"buttons-second-row",icon:"../projects/wallet/img/icons/history.png",text:qiwi.i18n("mainMenuPage.buttons.history"),onClick:function(){return page.actionWithAuth({action:function(){return page.jump("history")},onCancel:function(){return page.setUserInfo()},full:!0})}})),React.createElement("div",{className:"oferta-message"},qiwi.i18n("mainMenuPage.oferta_text").replace(/(\[).*$/g,""),React.createElement("span",{className:"button",onClick:function(){return page.jump("oferta")}},qiwi.i18n("mainMenuPage.oferta_text").replace(/^.*(\[)|(\]).*$/g,"")),qiwi.i18n("mainMenuPage.oferta_text").replace(/.*(\])/g,""))))}})})}},{key:"state",get:function(){return{authorized:this.authorized,unpaidInvoicesCount:this.unpaidInvoicesCount,balance:this.balance,phone:this.phone,needAuth:this.needAuth}}}]),_class}(RequiredWalletAuth),_export("default",_class)}}});
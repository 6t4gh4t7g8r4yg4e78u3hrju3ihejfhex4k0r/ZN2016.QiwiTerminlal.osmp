"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};define("../../projects/transpayments/js/pages/_account",["jsx!pages/page","stores/regProvider"],function(a,b){var c=function(a){function c(){_classCallCheck(this,c),_get(Object.getPrototypeOf(c.prototype),"constructor",this).call(this,"_account")}return _inherits(c,a),_createClass(c,[{key:"onShow",value:function(){_get(Object.getPrototypeOf(c.prototype),"onShow",this).call(this),this.isQwertyKeyboard=this.session.get("provider").mask.indexOf("w")>-1,this.mask=this.getMask(this.session.get("provider").mask),this.setLogoAndHeader(),this.updateField(this.session.get("account")?this.session.get("account"):"",!0),this.update()}},{key:"setLogoAndHeader",value:function(){this.setHeader(qiwi.i18n("account_page.title")," ",this.session.get("regProvider").shortName),this.setLogo(this.session.get("regProvider").logo?"../img/ui_item/"+this.session.get("regProvider").logo:"../projects/transpayments/img/logo.png")}},{key:"getMask",value:function(a){return a.indexOf("\\d+")>=0||a.indexOf("\\w+")>=0?null:{inner:this.replacer(a,"*"),shown:this.replacer(a,"X")}}},{key:"replacer",value:function(a,b){var c=/\\(d|w|\.)(\+|\*|\{(\d+)(?:,(\d+))?\})/g;return a.replace(c,function(){for(var a="",c=0;c<arguments[3];c++)a+=b;return a})}},{key:"performBackward",value:function(){1==this.session.get("country").langs.length?this.exit():this.backward()}},{key:"performForward",value:function(){this.session.set("account",this.account),this.session.set("maskedAccount",this.mask?qiwi.utils.mask(this.account,this.mask.inner):this.account),this.forward()}},{key:"disabledForward",value:function(){_get(Object.getPrototypeOf(c.prototype),"disabledForward",this).call(this),void 0!=this.account&&this.account.length>0&&this.showPopup({type:"info",title:qiwi.i18n("account_page.wrong_account"),message:"",okButtonText:qiwi.i18n("account_page.try_button")})}},{key:"updateField",value:function(a,b){if(void 0===this.account||null===a||void 0!=this.account&&this.account.length<this.session.get("provider").maxLength||""==a){null===a?this.account=this.account.slice(0,-1):""===a?this.account=a:b?this.account=a:this.account+=a,0==this.session.get("provider").no_change_prv&&this.tryProviderChange();var c=!1;c=this.session.get("provider").masks.length>0?this.checkAccountByMasks(this.session.get("provider").masks,this.account):new RegExp(this.mask?this.session.get("provider").mask.replace(/\(|\)/g,"\\$&").replace(/\+/g,"\\+"):this.session.get("provider").mask).test(this.mask?qiwi.utils.mask(this.account,this.mask.inner):this.account),this.updateNavigation({nextButton:{enabled:c}}),this.update()}}},{key:"tryProviderChange",value:function(){var a=this,c=this.session.get("providers").filter(function(b){return b.country==a.session.get("provider").country&&b.id!=a.session.get("provider").id&&0==b.no_change_prv});if(c.length>0){var d=c.map(function(b){return b.masks.length>0&&a.checkAccountByMasks(b.masks,a.account)?b:void 0});1==d.length&&void 0!=d[0]&&(this.session.set("provider",d[0]),b.getProvider(this.session.get("provider").osmp_id).then(function(b){a.session.set("regProvider",b),a.session.get("regProvider").shortName=a.session.get("provider").name,a.setLogoAndHeader()}).done(),this.update())}}},{key:"checkAccountByMasks",value:function(a,b){return a.filter(function(a){var c=a.value.split("").map(function(a,c){return"X"!=a||c>b.length-1?a:b.charAt(c)}).join("");return c==b}).length>0}},{key:"createClass",value:function(){var a=this;return this.loadElements(["field","keyboard","numpad"]).then(function(b){var d=_slicedToArray(b,3),e=d[0],f=d[1],g=d[2];return _get(Object.getPrototypeOf(c.prototype),"createClass",a).call(a,{getInitialState:function(){return{shift:!0,language:"eng"}},render:function(){var a=this.props.context;return React.createElement("div",{id:"account-page"},React.createElement(e,{onEraseClick:function(){return a.updateField(null)},text:this.props.account,width:"1100",eraseWidth:"133",mask:this.props.mask?{inner:this.props.mask.inner,shown:this.props.mask.shown}:null}),this.props.isQwertyKeyboard?React.createElement(f,{onClick:function(b){return a.updateField(b)},onEraseAll:function(){return a.updateField("")},controlOptions:{shiftDisabled:!1,languageDisabled:!1},defaultLanguage:this.state.language,showOptions:{alwaysCaps:!0},shift:this.state.shift}):React.createElement(g,{onClick:function(b){return a.updateField(b)}}))}})})}},{key:"state",get:function(){return{account:this.account,isQwertyKeyboard:this.isQwertyKeyboard,mask:this.mask}}}]),c}(a);return c});
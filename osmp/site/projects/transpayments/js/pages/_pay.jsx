"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};define("../../projects/transpayments/js/pages/_pay",["jsx!pages/page","../utils/_acceptor","../utils/_commissions"],function(a,b,c){var d=function(a){function d(){_classCallCheck(this,d),_get(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,"_pay")}return _inherits(d,a),_createClass(d,[{key:"onTimeout",value:function(){}},{key:"onShow",value:function(){var a=this;_get(Object.getPrototypeOf(d.prototype),"onShow",this).call(this),this.cash="0 руб.",this.pay_summ="-1",this.commiss="-1",this.limits="",this.forbidden="",this.deficient="",this.session.set("payment",{cash:0,pay:0,commiss:0,txn_id:"",status:"zero"}),this.showPreloader(),this.acceptor=new b,this.acceptor.on("updateAcceptor",function(b){return a.onAcceptorUpdate(b)}),this.acceptor.on("timeoutAcceptor",function(){return a.onAcceptorTimeout()}),this.acceptor.on("preloaderAcceptor",function(b){return a.onAcceptorWaiting(b)}),this.acceptor.begin({prv_id:this.session.get("provider").pay_id,prv_name:"Visa QIWI Wallet",account:"7"+this.session.get("phone"),extras:{_extra_comment:'Оплата:Пров. др. стран через РФ:"'+this.session.get("account").toString().charAt(0)+"***"+this.session.get("account").toString().charAt(this.session.get("account").toString().length-1)+" client-software: "+qiwi.application.toString(),_extra_ev_account0:"id:"+this.session.get("provider").id+";acc:"+this.session.get("provider").add_prefix+this.session.get("account")+";sum:15000;client-software:"+qiwi.application.toString(),_extra_ev_trm_id:qiwi.terminal.id},receipt:{"_receipt_Ваши+платежи":"\n"+this.session.get("regProvider").shortName+": "+this.session.get("maskedAccount"),_receipt_prt_top_reklama:"Больше возможностей на сайте: WWW.QIWI.COM",_receipt_prt_bottom_reklama:"Телефон поддержки Visa QIWI Wallet: 8(800)333-00-59"},fail_receipt:{_receipt_:qiwi.i18n("pay_page.deficient_alert")},min_summ:this.session.get("regProvider").constParams.min_summ,max_summ:this.session.get("regProvider").constParams.max_summ}).then(function(b){a.hidePreloader(),a.setHeader("","",a.session.get("regProvider").shortName),a.setLogo(a.session.get("regProvider").logo?"../img/ui_item/"+a.session.get("regProvider").logo:"../projects/transpayments/img/logo.png"),a.updateNavigation({nextButton:{visible:!1}}),a.commissions=new c(b.commissions,a.session.get("provider").pay_id),a.limits=b.limits,a.forbidden=b.forbidden,a.rateInfo=a.session.get("provider").rate?a.session.get("provider").rate.formattedRate():"0;0"!=a.session.get("provider").rates?qiwi.i18n("all_pages.default_rate"):"",a.update()})["catch"](function(b){a.hidePreloader(),a.showPopup({type:"error",title:qiwi.i18n("all_pages.error_title"),message:qiwi.i18n("pay_page.error_begin_acceptor"),okHandler:function(){return a.exit()}})}).done()}},{key:"onAcceptorWaiting",value:function(a){a.show?this.showPreloader():this.hidePreloader()}},{key:"onAcceptorUpdate",value:function(a){var b=a.cash,c=a.pay_summ,d=a.commiss;this.deficient="",b&&(this.cash=b.toString()+" руб.",this.session.get("payment").cash=b),c&&c>0&&(this.session.get("payment").pay=c,this.session.get("provider").rate&&"0"!=this.session.get("provider").show_summ_in_currency?(this.pay_summ_in_curr=qiwi.utils.toSum(this.session.get("provider").rate.convert(c))+" "+this.session.get("provider").rate_desc,this.pay_summ=c.toString()+" руб."):(this.pay_summ_in_curr=c.toString()+" руб.",this.pay_summ=""),this.session.get("payment").commiss=d,this.commiss=d.toString()+" руб."),b>0&&this.updateNavigation({prevButton:{visible:!1},nextButton:{visible:!0},exitButton:{visible:!1}}),this.update()}},{key:"onAcceptorTimeout",value:function(a){this.performForward()}},{key:"performBackward",value:function(){var a=this;this.acceptor.end().then(function(b){a.backward()})["catch"](function(a){}).done()}},{key:"performForward",value:function(){var a=this;this.acceptor.pay().then(function(b){a.session.get("payment").txn_id=b.txn_id,a.session.get("payment").status=b.success?"full":"deficient",a.forward()})["catch"](function(b){b.fatal?(a.session.get("payment").status="zero",a.forward()):(a.deficient=qiwi.i18n("pay_page.deficient")+b.deficient,a.update())}).done()}},{key:"performExit",value:function(){var a=this;this.acceptor.end().then(function(b){a.exit()})["catch"](function(a){}).done()}},{key:"showCommiss",value:function(){var a=this;this.loadElements(["commissionsPopupContent"]).then(function(b){var c=_slicedToArray(b,1),d=c[0];a.showPopup({type:"info",customContent:a.createReactElement(d,{title:qiwi.i18n("pay_page.commiss_popup_title"),profiles:a.commissions.profiles,summComment:qiwi.i18n("pay_page.commiss_summ"),commissComment:qiwi.i18n("pay_page.commiss_value")}),okButtonText:"Назад"})})["catch"](function(a){throw new qiwi.errors.SystemError("Error load element for popup: ",a)}).done()}},{key:"createClass",value:function(){var a=this;return this.loadElements(["moneyItem","button"]).then(function(b){var c=_slicedToArray(b,2),e=c[0],f=c[1];return _get(Object.getPrototypeOf(d.prototype),"createClass",a).call(a,{render:function(){var a=this.props.context,b=this.props.deficient&&this.props.deficient.length>0;return React.createElement("div",{id:"pay-page"},React.createElement("div",{className:"head"},React.createElement("div",null,qiwi.i18n("pay_page.title"))),React.createElement("div",{className:"limits"},this.props.limitsInfo),React.createElement("div",{className:"forbidden"},this.props.forbiddenInfo),React.createElement("div",{className:"main"},React.createElement("div",{className:"items"},React.createElement(e,{label:qiwi.i18n("pay_page.cash"),warn:b,bubble:this.props.deficient,value:this.props.cash}),React.createElement(e,{label:qiwi.i18n("pay_page.pay_summ"),warn:!1,bubble:this.props.pay_summ,value:this.props.pay_summ_in_curr}),React.createElement(e,{label:qiwi.i18n("pay_page.commiss"),warn:!1,bubble:"",value:this.props.commiss}))),React.createElement(f,{className:"commiss-button",text:qiwi.i18n("pay_page.commiss_button"),onClick:function(){return a.showCommiss()}}),React.createElement("div",{className:"rateInfo"},this.props.rateInfo))}})})}},{key:"state",get:function(){return{cash:this.cash,pay_summ:this.pay_summ,pay_summ_in_curr:this.pay_summ_in_curr,commiss:this.commiss,limitsInfo:this.limits,forbiddenInfo:this.forbidden,rateInfo:this.rateInfo,deficient:this.deficient}}}]),d}(a);return d});
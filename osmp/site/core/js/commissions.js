"use strict";System.register(["dispatcher"],function(_export,_context){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var Dispatcher,_createClass,Commissions;return{setters:[function(_dispatcher){Dispatcher=_dispatcher["default"]}],execute:function(){_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Commissions=function(_Dispatcher){function Commissions(initObj,prvId){_classCallCheck(this,Commissions);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Commissions).call(this));return _this._profiles=initObj.filter(function(item){return item.providerId==prvId})[0].commissionInfo.map(function(commission){var tmp={bound:Number(commission.fromAmount)||0,rate:Number(commission.commissionPercent),fixed:Number(commission.commissionFix)||0,max:Number("inf"===commission.commissionMax?null:commission.commissionMax)||Number.MAX_VALUE,min:Number(commission.commissionMin)||0,upperBound:"inf"===commission.toAmount?null:commission.toAmount};return tmp.isDefault=!commission.toAmount&&!commission.fromAmount&&!commission.commissionFix&&!commission.commissionMin&&!commission.commissionMax&&qiwi.utils.isCorrectNumber(tmp.rate),tmp.upperBound=Number(tmp.upperBound)||15e3,tmp.max<tmp.min&&(tmp.max=tmp.min),tmp}),_this}return _inherits(Commissions,_Dispatcher),_createClass(Commissions,[{key:"getComment",value:function(itm){var s="";return itm.fixed&&(s+=itm.fixed+" руб."),itm.fixed&&0!==itm.rate&&(s+=" + "),itm.fixed&&0===itm.rate||(s+=qiwi.utils.round2(itm.rate)+"%"),itm.min&&(s+=", но не менее "+qiwi.utils.toSum(itm.min)+" руб."),itm.max!==Number.MAX_VALUE&&(s+=(itm.min?" и не":", но")+" не более "+qiwi.utils.toSum(itm.max)+" руб."),s}},{key:"comissionSumCalc",value:function(sum){try{for(var i=0;i<this._profiles.length;i++){var p=this._profiles[i];if((isNaN(p.bound)||sum>=p.bound)&&(isNaN(p.upperBound)||sum<=p.upperBound)){var tempSum=isNaN(p.rate)?0:sum*(p.rate/100);return isNaN(p.fixed)||(tempSum+=p.fixed),!isNaN(p.min)&&tempSum<p.min?p.min:!isNaN(p.max)&&tempSum>p.max?p.max:tempSum}}return 0}catch(ex){}return 0}},{key:"getQiwiWalletReverseCummission",value:function(summ){for(var defaultMaxValue=arguments.length<=1||void 0===arguments[1]?15e3:arguments[1],i=0;i<this._profiles.length;i++){var profile=qiwi.utils.clone(this._profiles[i]);!isNaN(profile.fixed)&&summ<profile.fixed&&(summ+=profile.fixed),isNaN(profile.bound)&&(profile.bound=0),isNaN(profile.upperBound)&&(profile.upperBound=defaultMaxValue);var commission=void 0;if(isNaN(profile.fixed)||(summ-=profile.fixed),commission=isNaN(profile.rate)?0:summ-summ/(1+profile.rate/100),isNaN(profile.fixed)||(commission+=profile.fixed),!isNaN(profile.min)&&commission<profile.min&&(commission=profile.min),!isNaN(profile.max)&&commission>profile.max&&(commission=profile.max),summ>=profile.bound&&summ<=profile.upperBound)return qiwi.utils.round2(commission)}return 0}},{key:"applicability",value:function(itm){return itm.isDefault?"Другие условия":(15e3===itm.upperBound?"от "+itm.bound:itm.bound+" - "+itm.upperBound)+"\n					руб."}},{key:"isSinglePercent",get:function(){return 1==this._profiles.length&&0==this._profiles[0].min&&this._profiles[0].max==Number.MAX_VALUE&&0==this._profiles[0].fixed}},{key:"profiles",get:function(){var _this2=this;return this._profiles.map(function(item){return{summ:_this2._profiles.length>1?_this2.applicability(item):"Для любых сумм",commiss:_this2.getComment(item),rate:item.rate}})}}]),Commissions}(Dispatcher),_export("default",Commissions)}}});
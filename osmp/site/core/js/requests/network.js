"use strict";System.register(["dispatcher","terminal"],function(_export,_context){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var Dispatcher,terminal,_createClass,_class;return{setters:[function(_dispatcher){Dispatcher=_dispatcher["default"]},function(_terminal){terminal=_terminal["default"]}],execute:function(){_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_class=function(_Dispatcher){function _class(type){_classCallCheck(this,_class);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(_class).call(this));return _this._aid=1,_this.type=type,_this}return _inherits(_class,_Dispatcher),_createClass(_class,[{key:"templates",value:function(context){return[{type:"sendmail",body:{key:"sendmail",value:JSON.stringify({address:context.address,text:context.text,subject:context.subject})}},{type:"p3",body:{key:"proxy",value:JSON.stringify({path:"qode.jsp",aid:"1",timeout:context.timeout||30,request:{rev:"1",target:{key:context.app_key},request:{params:context.params,id:context.id,jsonrpc:"2.0",method:context.method}}})}}]}},{key:"getTemplate",value:function(type,context){return this.templates(context).filter(function(element){return element.type===type})}},{key:"send",value:function(params){var _this2=this,type=this.type;if(this.template=this.getTemplate(type,params)[0].body,this.template)return new Promise(function(resolve,reject){function execute(){terminal.send("network."+self.template.key,self.template.value,"network."+self.template.key).then(function(res){if("error"===res["network."+self.template.key])reject({response:{code:-100,message:"Fatal error network."+self.template.key}});else{var result=res["network."+self.template.key];resolve({response:{code:0,message:"OK",body:result}})}})["catch"](function(error){reject(error)})}var self=_this2;execute()})["catch"](function(error){return Promise.reject(error)});var error=new Error("Unhandled request error[network."+type+"]",-104);return console.error(error),Promise.reject(error)}}]),_class}(Dispatcher),_export("default",_class)}}});
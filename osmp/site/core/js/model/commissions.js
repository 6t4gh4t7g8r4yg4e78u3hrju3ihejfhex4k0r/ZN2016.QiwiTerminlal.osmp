"use strict";System.register(["constants/currency"],function(_export,_context){function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var Currency,_get,_createClass,Commission,AgentCommission,Commissions;return{setters:[function(_constantsCurrency){Currency=_constantsCurrency["default"]}],execute:function(){_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_export("Commission",Commission=function(){function Commission(){var _ref=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],_ref$bound=_ref.bound,bound=void 0===_ref$bound?0:_ref$bound,_ref$rate=_ref.rate,rate=void 0===_ref$rate?0:_ref$rate,fixed=_ref.fixed,max=_ref.max,min=_ref.min;_classCallCheck(this,Commission),this.bound=Number(bound)||0,this.rate=Number(rate)||0,this.fixed=Number(fixed)||0,this.min=Number(min)||0,this.max=Number(max)||Number.MAX_VALUE,this.max<this.min&&(this.max=this.min)}return _createClass(Commission,[{key:"applicability",value:function(){var currency=arguments.length<=0||void 0===arguments[0]?Currency.DEFAULT:arguments[0];return"от "+this.bound+" "+Currency.getCurrency(currency)}},{key:"commission",value:function(){var sum=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return sum<this.bound?null:Math.min(Math.max(this.fixed+sum*this.rate,this.min),this.max)}},{key:"reverse",value:function(){var sum=arguments.length<=0||void 0===arguments[0]?0:arguments[0],commission=Math.min(Math.max(sum-(sum-this.fixed)/(1+this.rate),this.min),this.max);return Math.max(sum-commission,0)<this.bound?null:commission}},{key:"comment",value:function(){var currency=arguments.length<=0||void 0===arguments[0]?Currency.DEFAULT:arguments[0];currency=Currency.getCurrency(currency);var s="";return this.fixed&&(s+=this.fixed+" "+currency),this.fixed&&0!==this.rate&&(s+=" + "),this.fixed&&0===this.rate||(s+=qiwi.utils.round2(100*this.rate)+"%"),this.min&&(s+=", но не менее "+qiwi.utils.toSum(this.min)+" "+currency),this.max!==Number.MAX_VALUE&&(s+=(this.min?" и не":", но")+" не более "+qiwi.utils.toSum(this.max)+" "+currency),s}},{key:"isDummy",get:function(){return 0===this.bound&&0===this.rate&&0===this.fixed&&0===this.min&&this.max===Number.MAX_VALUE}}],[{key:"parseJSON",value:function(json){return json&&json.commissionInfo?new Commissions({ranges:json.commissionInfo.map(function(_ref2){var fromAmount=_ref2.fromAmount,toAmount=_ref2.toAmount,commissionPercent=_ref2.commissionPercent,commissionFix=_ref2.commissionFix,commissionMax=_ref2.commissionMax,commissionMin=_ref2.commissionMin;return{bound:fromAmount||0,rate:commissionPercent,fixed:commissionFix,max:"inf"===commissionMax?null:commissionMax,min:commissionMin,upperBound:"inf"===toAmount?null:toAmount}})},!0):null}}]),Commission}()),_export("AgentCommission",AgentCommission=function(_Commission){function AgentCommission(_ref3){var bound=_ref3.bound,upperBound=_ref3.upperBound,rate=_ref3.rate,fixed=_ref3.fixed,max=_ref3.max,min=_ref3.min;_classCallCheck(this,AgentCommission);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(AgentCommission).call(this,{bound:bound,rate:rate/100,fixed:fixed,max:max,min:min}));return _this.isDefault=!upperBound&&!_this.bound&&!_this.fixed&&!_this.min&&_this.max===Number.MAX_VALUE&&qiwi.utils.isCorrectNumber(_this.rate),_this.upperBound=Number(upperBound)||15e3,_this}return _inherits(AgentCommission,_Commission),_createClass(AgentCommission,[{key:"applicability",value:function(){var currency=arguments.length<=0||void 0===arguments[0]?Currency.DEFAULT:arguments[0];return this.isDefault?"Другая сумма":this.upperBound>=15e3?_get(Object.getPrototypeOf(AgentCommission.prototype),"applicability",this).call(this,currency):this.bound+" - "+this.upperBound+" "+Currency.getCurrency(currency)}},{key:"commission",value:function(){var sum=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return sum>this.upperBound?null:_get(Object.getPrototypeOf(AgentCommission.prototype),"commission",this).call(this,sum)}},{key:"reverse",value:function(){var sum=arguments.length<=0||void 0===arguments[0]?0:arguments[0],commission=_get(Object.getPrototypeOf(AgentCommission.prototype),"reverse",this).call(this,sum);return null===commission||Math.max(sum-commission,0)>this.upperBound?null:commission}}]),AgentCommission}(Commission)),_export("Commissions",Commissions=function(){function Commissions(){var _ref4=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],ranges=_ref4.ranges,isAgent=arguments[1];_classCallCheck(this,Commissions),isAgent?this.ranges=(ranges||[]).map(function(r){return new AgentCommission(r)}):this.ranges=(ranges||[]).map(function(r){return new Commission(r)}).sort(function(a,b){return a.bound-b.bound}),0===this.ranges.length&&this.ranges.push(new Commission)}return _createClass(Commissions,[{key:"comment",value:function(currency){return this.ranges.map(function(r){return r.comment(currency)})[0]}},{key:"forward",value:function(sum){return Math.max(0,qiwi.utils.round2(this.ranges.map(function(r){return r.commission(sum)}).filter(function(r){return qiwi.utils.correctNumbers(r)})[0]))}},{key:"forwardSum",value:function(sum){return Math.max(0,qiwi.utils.round2(this.forward(sum)+sum))}},{key:"reverse",value:function(sum){return Math.max(0,qiwi.utils.round2(this.ranges.map(function(r){return r.reverse(sum)}).filter(function(r){return qiwi.utils.correctNumbers(r)})[0]))}},{key:"reverseSum",value:function(sum){return Math.max(0,qiwi.utils.round2(sum-this.reverse(sum)))}},{key:"comissionSumCalc",value:function(sum){return this.forward(sum)}},{key:"isDummy",get:function(){return 1===this.length&&this.ranges[0].isDummy}},{key:"profiles",get:function(){var _this2=this;return this.ranges.map(function(range){return{applicability:1===_this2.ranges.length&&_this2.ranges[0].bound<=0&&(void 0===_this2.ranges[0].upperBound||_this2.ranges[0].upperBound>=15e3)?"Любая сумма":range.applicability(),comment:range.comment(),commiss:range.comment(),rate:range.rate}})}},{key:"length",get:function(){return this.ranges.length}},{key:"isSinglePercent",get:function(){var single=this.ranges[0];return 1===this.length&&0===single.min&&single.max===Number.MAX_VALUE&&0===single.fixed}}]),Commissions}()),_export("Commission",Commission),_export("AgentCommission",AgentCommission),_export("Commissions",Commissions)}}});
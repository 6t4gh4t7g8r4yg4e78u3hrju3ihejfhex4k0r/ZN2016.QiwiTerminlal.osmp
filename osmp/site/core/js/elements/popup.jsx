"use strict";System.register(["jsx!elements/button"],function(_export,_context){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var Button,_createClass,_React,Component,PropTypes,Popup;return{setters:[function(_jsxElementsButton){Button=_jsxElementsButton["default"]}],execute:function(){_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_React=React,Component=_React.Component,PropTypes=_React.PropTypes,Popup=function(_Component){function Popup(props){_classCallCheck(this,Popup);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Popup).call(this,props));return _this.state={title:"",message:"",buttons:[],icon:"",id:""},_this}return _inherits(Popup,_Component),_createClass(Popup,[{key:"componentWillUnmount",value:function(){this.state.timer&&clearInterval(this.state.timer)}},{key:"componentWillMount",value:function(){this.componentWillReceiveProps(this.props)}},{key:"componentWillReceiveProps",value:function(props){var _this2=this,p=props,titleByType=void 0,buttons=void 0,icon="";switch(p.type){case"error":buttons=[{className:"regular-button"+(p.cancelButtonAutoSize?" resizeable":""),text:p.okButtonText||"ОК",width:Math.max(30*(p.okButtonText||"ОК").length,300).toString(),trigger:function(){return _this2.okTrigger()}}],titleByType=qiwi.i18n("popups.error"),icon="error";break;case"info":buttons=[{className:"regular-button"+(p.cancelButtonAutoSize?" resizeable":""),text:p.okButtonText||"ОК",width:Math.max(30*(p.okButtonText||"ОК").length,300).toString(),trigger:function(){return _this2.okTrigger()}}],titleByType=qiwi.i18n("popups.information");break;case"question":buttons=[{className:"regular-button"+(p.cancelButtonAutoSize?" resizeable":""),text:p.cancelButtonText||"НЕТ",width:Math.max(25*(p.cancelButtonText?p.cancelButtonText:"НЕТ").length,300).toString(),trigger:function(){return _this2.cancelTrigger()}},{className:"primary-button"+(p.okButtonAutoSize?" resizeable":""),text:p.okButtonText||"ДА",width:Math.max(30*(p.okButtonText?p.okButtonText:"ДА").length,300).toString(),trigger:function(){return _this2.okTrigger()}}],icon="warning";break;case"dialog":buttons=[{className:"regular-button"+(p.cancelButtonAutoSize?" resizeable":""),text:p.cancelButtonText||"НЕТ",width:Math.max(25*(p.cancelButtonText||"НЕТ").length,300).toString(),trigger:function(){return _this2.cancelTrigger()}},{className:"regular-button"+(p.okButtonAutoSize?" resizeable":""),text:p.okButtonText||"ДА",width:Math.max(25*(p.okButtonText||"ДА").length,300).toString(),trigger:function(){return _this2.okTrigger()}}],icon="warning";break;case"attention":buttons=[{className:"primary-button"+(p.okButtonAutoSize?" resizeable":""),text:p.okButtonText||"ОК",width:Math.max(30*(p.okButtonText||"ДА").length,300).toString(),trigger:function(){return _this2.okTrigger()}}],titleByType=qiwi.i18n("popups.attention"),icon="warning";break;case"timeout":titleByType=qiwi.i18n("popups.ten_seconds");default:buttons=[{className:"primary-button"+(p.okButtonAutoSize?" resizeable":""),text:p.cancelButtonText||"ОТМЕНА",width:Math.max(25*(p.cancelButtonText||"НЕТ").length,300).toString(),trigger:function(){return _this2.okTrigger()}}],icon="warning"}this.setState({title:p.customContent?p.title:p.title||titleByType,message:p.message,buttons:buttons,id:"timeout"===p.type?"exit-popup":"default-popup",type:p.type,icon:"",customContent:p.customContent}),"timeout"===p.type&&this.startCountdown()}},{key:"varySeconds",value:function(n){switch(n){case 2:case 3:case 4:return"секунды";case 1:return"секунду";default:return"секунд"}}},{key:"startCountdown",value:function(){var _this3=this;this.setState({timer:setInterval(function(){return _this3.setState({seconds:_this3.state.seconds-1,title:"Выход через "+(_this3.state.seconds-1)+" "+_this3.varySeconds(_this3.state.seconds-1)})},1e3),seconds:10})}},{key:"componentWillUpdate",value:function(nProps,nState){0===nState.seconds&&"timeout"===nState.type&&(clearInterval(nState.timer),this.cancelTrigger())}},{key:"okTrigger",value:function(){try{this.props.hide()}catch(e){}this.props.okHandler&&qiwi.utils.delay(qiwi.utils.bind(this.props.okHandler,this),50)}},{key:"cancelTrigger",value:function(){try{this.props.hide()}catch(e){}this.props.cancelHandler&&qiwi.utils.delay(qiwi.utils.bind(this.props.cancelHandler,this),50)}},{key:"render",value:function(){var s=this.state;return React.createElement("div",{id:s.id,className:"popup "+s.type},React.createElement("div",{className:"popup-container"},s.customContent||null,s.icon?React.createElement("div",{className:"icon",style:{background:"transparent url('./img/icons/"+this.state.icon+(document.config.isLight?"-light":"")+".png') no-repeat scroll center center",width:"94px",height:"90px",marginTop:"17px"}}):null,s.title?React.createElement("div",{className:"title"},s.title):null,s.message?React.createElement("div",{className:"message"},React.isValidElement(s.message)?s.message:s.message.toString()):null,React.createElement("div",{className:"popup-buttons-container "+(s.buttons.length>1?"n"+s.buttons.length:"")},s.buttons.map(function(item,index){return React.createElement("div",{key:index,className:"popup-button"},React.createElement(Button,{className:item.className,width:item.width,text:item.text,onClick:function(){return item.trigger()}}))}))))}}]),Popup}(Component),Popup.propTypes={currentCount:PropTypes.number,counter:PropTypes.number,countdownTimer:PropTypes.func,hide:PropTypes.func},_export("default",Popup)}}});